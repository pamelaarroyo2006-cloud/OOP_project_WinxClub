package iems.ui;

import iems.model.User;
import iems.model.Role;

import javax.swing.*;
import java.awt.*;
import javax.swing.border.EmptyBorder;

public class DashboardFrame extends JFrame {
    private final CardLayout cards = new CardLayout();
    private final JPanel content = new JPanel(cards);
    private JButton activeNavButton = null;
    private final User user;

    // Updated color scheme for better visibility (like in the image)
    private static final Color SIDEBAR_BG = new Color(30, 41, 59); // Dark blue sidebar
    private static final Color NAV_INACTIVE_TEXT = new Color(200, 210, 220); // Much brighter for visibility
    private static final Color NAV_INACTIVE_BG = new Color(30, 41, 59); // Same as sidebar
    private static final Color NAV_HOVER_BG = new Color(45, 55, 75); // Slightly lighter on hover
    private static final Color NAV_HOVER_TEXT = new Color(240, 240, 240); // Brighter on hover
    private static final Color NAV_ACTIVE_BG = new Color(37, 99, 235); // Blue background for active
    private static final Color NAV_ACTIVE_TEXT = Color.WHITE; // White text for active

    // SPECIAL COLORS FOR DASHBOARD BUTTON ONLY
    private static final Color DASHBOARD_INACTIVE_BG = new Color(40, 51, 69); // Slightly lighter than sidebar
    private static final Color DASHBOARD_INACTIVE_TEXT = new Color(220, 230, 240); // Even brighter text
    private static final Color DASHBOARD_ACTIVE_BG = new Color(37, 99, 235); // Blue background (same as regular active)
    private static final Color DASHBOARD_ACTIVE_TEXT = Color.WHITE; // White text
    @SuppressWarnings("unused")
    private static final Color SETTINGS_COLOR = new Color(200, 210, 220); // Bright text
    private static final Color LOGOUT_COLOR = new Color(239, 100, 100); // Brighter red
    private static final Color MAIN_BG = new Color(241, 245, 249);

    // Button border colors
    @SuppressWarnings("unused")
    private static final Color BUTTON_BORDER = new Color(60, 70, 90);
    private static final Color ACTIVE_BUTTON_BORDER = new Color(96, 165, 250);

    public DashboardFrame(User user) {
        super("IEMS Dashboard - " + user.getFullName());
        this.user = user;

        setDefaultCloseOperation(JFrame.DO_NOTHING_ON_CLOSE);
        setSize(1400, 800);
        setMinimumSize(new Dimension(1200, 700));
        setLocationRelativeTo(null);

        // Handle window close
        addWindowListener(new java.awt.event.WindowAdapter() {
            @Override
            public void windowClosing(java.awt.event.WindowEvent windowEvent) {
                confirmAndLogout();
            }
        });

        // Use system look and feel
        try {
            UIManager.setLookAndFeel(UIManager.getSystemLookAndFeelClassName());
        } catch (Exception e) {
            e.printStackTrace();
        }

        // Create main layout
        JSplitPane splitPane = new JSplitPane(JSplitPane.HORIZONTAL_SPLIT);
        splitPane.setLeftComponent(createSidebar());
        splitPane.setRightComponent(content);
        splitPane.setDividerLocation(280);
        splitPane.setDividerSize(1);
        splitPane.setEnabled(false); // Prevent resizing of divider

        // Set content background
        content.setBackground(MAIN_BG);

        add(splitPane, BorderLayout.CENTER);

        // Initialize panels
        initializePanels();

        // Show appropriate panel
        if (user.getRole() == Role.TEACHER) {
            cards.show(content, "teacher");
        } else {
            cards.show(content, "materials");
        }
    }

    private JPanel createSidebar() {
        JPanel sidebar = new JPanel(new BorderLayout());
        sidebar.setBackground(SIDEBAR_BG);
        sidebar.setPreferredSize(new Dimension(280, 0));

        // Header Panel
        JPanel headerPanel = new JPanel(new BorderLayout());
        headerPanel.setBackground(SIDEBAR_BG);
        headerPanel.setBorder(new EmptyBorder(30, 25, 30, 25));

        JLabel appTitle = new JLabel("TEAMS");
        appTitle.setFont(new Font("Segoe UI", Font.BOLD, 28));
        appTitle.setForeground(Color.WHITE);

        JLabel userLabel = new JLabel(user.getFullName());
        userLabel.setFont(new Font("Segoe UI Semibold", Font.BOLD, 18));
        userLabel.setForeground(Color.WHITE);

        JLabel roleLabel = new JLabel(user.getRole().toString().toUpperCase());
        roleLabel.setFont(new Font("Segoe UI", Font.BOLD, 12));
        roleLabel.setForeground(new Color(148, 163, 184));

        JPanel userInfoPanel = new JPanel(new GridLayout(3, 1, 5, 5));
        userInfoPanel.setBackground(SIDEBAR_BG);
        userInfoPanel.add(appTitle);
        userInfoPanel.add(userLabel);
        userInfoPanel.add(roleLabel);

        headerPanel.add(userInfoPanel, BorderLayout.CENTER);
        sidebar.add(headerPanel, BorderLayout.NORTH);

        // Navigation Panel - Removed buttons as requested
        JPanel navPanel = new JPanel();
        navPanel.setLayout(new BoxLayout(navPanel, BoxLayout.Y_AXIS));
        navPanel.setBackground(SIDEBAR_BG);
        navPanel.setBorder(new EmptyBorder(0, 20, 20, 20));

        if (user.getRole() == Role.TEACHER) {
            // Only keep the Dashboard button, remove all others as requested
            navPanel.add(createDashboardButton("Dashboard", "teacher", true));
        } else {
            navPanel.add(createNavButton("Learning Materials", "materials", true));
            navPanel.add(Box.createVerticalStrut(10));
            navPanel.add(createNavButton("Tutoring Programs", "tutoring"));
            navPanel.add(Box.createVerticalStrut(10));
            navPanel.add(createNavButton("Educational Support", "support"));
        }

        // Add scroll pane for navigation if needed
        JScrollPane navScroll = new JScrollPane(navPanel);
        navScroll.setBorder(null);
        navScroll.getViewport().setBackground(SIDEBAR_BG);
        navScroll.setHorizontalScrollBarPolicy(JScrollPane.HORIZONTAL_SCROLLBAR_NEVER);
        sidebar.add(navScroll, BorderLayout.CENTER);

        // Bottom Panel (Logout only - Settings removed as requested)
        JPanel bottomPanel = new JPanel(new BorderLayout());
        bottomPanel.setBackground(SIDEBAR_BG);
        bottomPanel.setBorder(new EmptyBorder(0, 20, 30, 20));

        JPanel bottomButtons = new JPanel(new GridLayout(1, 1, 10, 10)); // Changed to 1 button only
        bottomButtons.setBackground(SIDEBAR_BG);
        bottomButtons.add(createLogoutButton()); // Only Logout button, Settings removed

        bottomPanel.add(bottomButtons, BorderLayout.CENTER);
        sidebar.add(bottomPanel, BorderLayout.SOUTH);

        return sidebar;
    }

    // NEW METHOD: Special Dashboard button with different colors
    private JButton createDashboardButton(String text, String panelId, boolean active) {
        JButton button = new JButton(text);
        button.setAlignmentX(Component.LEFT_ALIGNMENT);
        button.setMaximumSize(new Dimension(Integer.MAX_VALUE, 45));
        button.setPreferredSize(new Dimension(240, 45));
        button.setFont(new Font("Segoe UI", active ? Font.BOLD : Font.PLAIN, 14));
        button.setFocusPainted(false);
        button.setHorizontalAlignment(SwingConstants.LEFT);
        button.setBorder(BorderFactory.createCompoundBorder(
                BorderFactory.createLineBorder(active ? ACTIVE_BUTTON_BORDER : Color.WHITE, 0), // No border like in
                                                                                                // image
                new EmptyBorder(12, 20, 12, 20) // More left padding
        ));
        button.setCursor(Cursor.getPredefinedCursor(Cursor.HAND_CURSOR));
        button.setOpaque(true);

        if (active) {
            activeNavButton = button;
            button.setBackground(DASHBOARD_ACTIVE_BG);
            button.setForeground(DASHBOARD_ACTIVE_TEXT);
        } else {
            button.setBackground(DASHBOARD_INACTIVE_BG); // Different background for dashboard
            button.setForeground(DASHBOARD_INACTIVE_TEXT); // Different text color for dashboard
        }

        // Hover effects
        button.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseEntered(java.awt.event.MouseEvent evt) {
                if (button != activeNavButton) {
                    button.setBackground(NAV_HOVER_BG);
                    button.setForeground(NAV_HOVER_TEXT); // Even brighter on hover
                }
            }

            public void mouseExited(java.awt.event.MouseEvent evt) {
                if (button != activeNavButton) {
                    button.setBackground(DASHBOARD_INACTIVE_BG); // Back to dashboard color
                    button.setForeground(DASHBOARD_INACTIVE_TEXT); // Back to dashboard text color
                }
            }
        });

        button.addActionListener(e -> {
            if (activeNavButton != null) {
                // Reset previous active button
                if (activeNavButton.getText().equals("Dashboard")) {
                    activeNavButton.setBackground(DASHBOARD_INACTIVE_BG);
                    activeNavButton.setForeground(DASHBOARD_INACTIVE_TEXT);
                } else {
                    activeNavButton.setBackground(NAV_INACTIVE_BG);
                    activeNavButton.setForeground(NAV_INACTIVE_TEXT);
                }
                activeNavButton.setFont(new Font("Segoe UI", Font.PLAIN, 14));
            }

            activeNavButton = button;
            button.setBackground(DASHBOARD_ACTIVE_BG); // Dashboard active color
            button.setForeground(DASHBOARD_ACTIVE_TEXT); // Dashboard active text color
            button.setFont(new Font("Segoe UI", Font.BOLD, 14));

            cards.show(content, panelId);
        });

        return button;
    }

    // Add this overloaded method
    private JButton createNavButton(String text, String panelId) {
        return createNavButton(text, panelId, false);
    }

    private JButton createNavButton(String text, String panelId, boolean active) {
        JButton button = new JButton(text);
        button.setAlignmentX(Component.LEFT_ALIGNMENT);
        button.setMaximumSize(new Dimension(Integer.MAX_VALUE, 45));
        button.setPreferredSize(new Dimension(240, 45));
        button.setFont(new Font("Segoe UI", active ? Font.BOLD : Font.PLAIN, 14));
        button.setFocusPainted(false);
        button.setHorizontalAlignment(SwingConstants.LEFT);
        button.setBorder(BorderFactory.createCompoundBorder(
                BorderFactory.createLineBorder(active ? ACTIVE_BUTTON_BORDER : Color.WHITE, 0), // No border like in
                                                                                                // image
                new EmptyBorder(12, 20, 12, 20) // More left padding
        ));
        button.setCursor(Cursor.getPredefinedCursor(Cursor.HAND_CURSOR));
        button.setOpaque(true);

        if (active) {
            activeNavButton = button;
            button.setBackground(NAV_ACTIVE_BG);
            button.setForeground(NAV_ACTIVE_TEXT);
        } else {
            button.setBackground(NAV_INACTIVE_BG);
            button.setForeground(NAV_INACTIVE_TEXT); // Use brighter text color
        }

        // Hover effects
        button.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseEntered(java.awt.event.MouseEvent evt) {
                if (button != activeNavButton) {
                    button.setBackground(NAV_HOVER_BG);
                    button.setForeground(NAV_HOVER_TEXT); // Even brighter on hover
                }
            }

            public void mouseExited(java.awt.event.MouseEvent evt) {
                if (button != activeNavButton) {
                    button.setBackground(NAV_INACTIVE_BG);
                    button.setForeground(NAV_INACTIVE_TEXT); // Back to bright text
                }
            }
        });

        button.addActionListener(e -> {
            if (activeNavButton != null) {
                // Reset previous active button
                if (activeNavButton.getText().equals("Dashboard")) {
                    activeNavButton.setBackground(DASHBOARD_INACTIVE_BG);
                    activeNavButton.setForeground(DASHBOARD_INACTIVE_TEXT);
                } else {
                    activeNavButton.setBackground(NAV_INACTIVE_BG);
                    activeNavButton.setForeground(NAV_INACTIVE_TEXT);
                }
                activeNavButton.setFont(new Font("Segoe UI", Font.PLAIN, 14));
            }

            activeNavButton = button;
            button.setBackground(NAV_ACTIVE_BG);
            button.setForeground(NAV_ACTIVE_TEXT);
            button.setFont(new Font("Segoe UI", Font.BOLD, 14));

            cards.show(content, panelId);
        });

        return button;
    }

    // Removed createSettingsButton() method entirely as requested

    private JButton createLogoutButton() {
        JButton button = new JButton("Logout");
        button.setFont(new Font("Segoe UI", Font.PLAIN, 14));
        button.setForeground(LOGOUT_COLOR);
        button.setBackground(new Color(60, 70, 90));
        button.setFocusPainted(false);
        button.setBorder(BorderFactory.createCompoundBorder(
                BorderFactory.createLineBorder(new Color(80, 90, 110), 1),
                new EmptyBorder(10, 15, 10, 15)));
        button.setCursor(Cursor.getPredefinedCursor(Cursor.HAND_CURSOR));

        button.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseEntered(java.awt.event.MouseEvent evt) {
                button.setBackground(new Color(80, 90, 110));
                button.setForeground(Color.WHITE);
            }

            public void mouseExited(java.awt.event.MouseEvent evt) {
                button.setBackground(new Color(60, 70, 90));
                button.setForeground(LOGOUT_COLOR);
            }
        });

        button.addActionListener(e -> confirmAndLogout());

        return button;
    }

    private void initializePanels() {
        if (user.getRole() == Role.TEACHER) {
            // Only initialize panels that will be accessible
            content.add(new TeacherDashboardPanel(user), "teacher");
            // Removed panels for buttons that were removed:
            // content.add(new StudentsPanel(user), "students");
            // content.add(new TeacherMaterialsPanel(user), "materials");
            // content.add(new AssignmentsPanel(user), "assignments");
            // content.add(new AnalyticsPanel(user), "analytics");
            // content.add(new CommunicationsPanel(user), "communications");
        } else {
            // Create placeholder panels for student view
            content.add(createPlaceholderPanel("Student Materials"), "materials");
            content.add(createPlaceholderPanel("Tutoring Programs"), "tutoring");
            content.add(createPlaceholderPanel("Educational Support"), "support");
        }

        // Removed Settings panel as requested
        // content.add(new SettingsPanel(user, this), "settings");
    }

    private JPanel createPlaceholderPanel(String title) {
        JPanel panel = new JPanel(new BorderLayout());
        panel.setBackground(MAIN_BG);

        JLabel label = new JLabel(title + " - " + user.getFullName(), SwingConstants.CENTER);
        label.setFont(new Font("Segoe UI", Font.BOLD, 24));
        label.setForeground(SIDEBAR_BG);

        panel.add(label, BorderLayout.CENTER);
        return panel;
    }

    private void confirmAndLogout() {
        int response = JOptionPane.showConfirmDialog(
                this,
                "Are you sure you want to logout, " + user.getFullName() + "?",
                "Confirm Logout",
                JOptionPane.YES_NO_OPTION,
                JOptionPane.QUESTION_MESSAGE);

        if (response == JOptionPane.YES_OPTION) {
            dispose();
            showLoginPanel();
        }
    }

    private void showLoginPanel() {
        SwingUtilities.invokeLater(() -> {
            try {
                UIManager.setLookAndFeel(UIManager.getCrossPlatformLookAndFeelClassName());
            } catch (Exception e) {
                e.printStackTrace();
            }

            JFrame loginFrame = new JFrame("Inclusive Education Management System");
            loginFrame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
            loginFrame.setSize(500, 550);
            loginFrame.setLocationRelativeTo(null);

            JPanel mainPanel = new JPanel(new BorderLayout()) {
                @Override
                protected void paintComponent(Graphics g) {
                    super.paintComponent(g);
                    Graphics2D g2 = (Graphics2D) g;
                    g2.setRenderingHint(RenderingHints.KEY_ANTIALIASING, RenderingHints.VALUE_ANTIALIAS_ON);

                    GradientPaint gp = new GradientPaint(
                            0, 0, new Color(59, 130, 246),
                            0, getHeight(), new Color(14, 165, 233));
                    g2.setPaint(gp);
                    g2.fillRect(0, 0, getWidth(), getHeight());
                }
            };

            LoginPanel login = new LoginPanel(
                    user -> {
                        try {
                            UIManager.setLookAndFeel(UIManager.getSystemLookAndFeelClassName());
                        } catch (Exception e) {
                            e.printStackTrace();
                        }
                        loginFrame.dispose();
                        new DashboardFrame(user).setVisible(true);
                    },
                    () -> {
                        JDialog registerDialog = new JDialog(loginFrame, "Register", true);
                        RegisterPanel reg = new RegisterPanel(u -> {
                            registerDialog.dispose();
                            JOptionPane.showMessageDialog(loginFrame,
                                    "Account created. You can now log in.",
                                    "Registration Successful",
                                    JOptionPane.INFORMATION_MESSAGE);
                        });
                        registerDialog.setContentPane(reg);
                        registerDialog.pack();
                        registerDialog.setSize(600, 700);
                        registerDialog.setLocationRelativeTo(loginFrame);
                        registerDialog.setVisible(true);
                    });

            mainPanel.add(login, BorderLayout.CENTER);
            loginFrame.setContentPane(mainPanel);
            loginFrame.setVisible(true);
        });
    }
}